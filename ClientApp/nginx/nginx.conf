server {
    listen 80;
    server_name localhost;

    # Root for Vue SPA or static welcome
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;  # For Vue router history mode
    }

    # /reserved/ redirects to root
    location = /reserved/ {
        return 301 /;
    }

    # Static documentation page
    location = /documentation {
        alias /usr/share/nginx/html/static/documentation.html;
        types { } default_type text/html;
    }

    # Static management page with links
    location = /management {
        alias /usr/share/nginx/html/static/management.html;
        types { } default_type text/html;
    }

    # Status page and assets
    location = /status {
        alias /usr/share/nginx/html/static/status.html;
        types { } default_type text/html;
    }
    location ~ ^/css/status\.css$ {
        alias /usr/share/nginx/html/static/css/status.css;
        types { } default_type text/css;
    }
    location ~ ^/js/status\.js$ {
        alias /usr/share/nginx/html/static/js/status.js;
        types { } default_type application/javascript;
    }

    # NGINX stub status for /status page to fetch
    location /nginx_status {
        stub_status on;
        access_log off;
        allow all;  # Allow internal fetches; restrict if needed
    }

    # Legacy proxy
    location /legacy/ {
        proxy_pass http://gamesbakery-web-master:80/legacy/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Admin proxy to Adminer
    location /admin/ {
        proxy_pass http://gamesbakery-adminer:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # API v1: Exact root serves Swagger, subpaths proxy to API
    location = /api/v1 {
        proxy_pass http://gamesbakery-web-master:80/swagger/v1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location ~ ^/api/v1/(.*) {
        proxy_pass http://gamesbakery-web-master:80/api/v1/$1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # API v2: Exact root serves Swagger, subpaths proxy to API
    location = /api/v2 {
        proxy_pass http://gamesbakery-web-master:80/swagger/v2;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    location ~ ^/api/v2/(.*) {
        proxy_pass http://gamesbakery-web-master:80/api/v2/$1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Optional: Keep general Swagger if needed
    location /swagger/ {
        proxy_pass http://gamesbakery-web-master:80/swagger/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}